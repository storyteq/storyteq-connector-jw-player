function StoryteqConnectorJwPlayer(parameters){var $vm=this;$vm.videoPlayerId=parameters.videoPlayerId;$vm.videoHash=$vm.getUrlParameter(parameters.videoParameterName);if(parameters.track){$vm.track=parameters.track}
if(parameters.verbose){$vm.verbose=parameters.verbose}
if(parameters.dataCallbackFunction){$vm.dataCallbackFunction=parameters.dataCallbackFunction}
if(parameters.defaultUrls){$vm.defaultUrls=parameters.defaultUrls}
$vm.jwplayerId='oNX7JPx1';if(parameters.jwplayerId){$vm.jwplayerId=parameters.jwplayerId}
$vm.delta=20;$vm.durationOfVideo=null;$vm.timecodes=[];$vm.videoStarted=!1;(function(){var script=document.createElement('script');script.type='text/javascript';if(script.readyState){if(script.readyState==='loaded'){$vm.getVideoData()}}else{script.onload=function(){$vm.getVideoData()}}
script.src='https://content.jwplatform.com/libraries/'+$vm.jwplayerId+'.js';document.getElementsByTagName('head')[0].appendChild(script)}())}
StoryteqConnectorJwPlayer.prototype.setJwPlayerInstance=function(response){var connector=this;var jwPlayerInstance=jwplayer(this.videoPlayerId);jwPlayerInstance.setup({file:this.videoUrl,image:this.posterUrl,events:{onReady:function(){if(this.track){connector.createAnalyticEmbed()}},onComplete:function(){if(this.verbose){console.log('Video watched for 100% (complete)')}
connector.videoStarted=!1;connector.createAnalyticView(100)},onPlay:function(){if(connector.videoStarted==!1){if(this.verbose){console.log('Video watched for 0% (playstart)')}
connector.videoStarted=!0;if(this.track){connector.createAnalyticView(0)}}},}});this.createPlayerButton(response,jwPlayerInstance);this.setEnvironment(jwPlayerInstance.getEnvironment());this.videoEventEmitter(jwPlayerInstance)}
StoryteqConnectorJwPlayer.prototype.createPlayerButton=function(response,jwPlayerInstance){if(response.data.player_logo==!0){jwPlayerInstance.addButton('https://storage.googleapis.com/storyteq-shared-assets/video-player/logo.png','Powered by StoryTEQ',function(){window.open('https://storyteq.com/?utm_source=stplayer','_blank')},'about')}}
StoryteqConnectorJwPlayer.prototype.round=function(value,precision){var multiplier=Math.pow(100,precision||0);return Math.round(value*multiplier)/multiplier}
StoryteqConnectorJwPlayer.prototype.videoEventEmitter=function(jwPlayerInstance){var connector=this;jwPlayerInstance.onTime(function(event){if(event.position>1&&connector.durationOfVideo==null){connector.durationOfVideo=jwPlayerInstance.getDuration();for(var i=1;i<connector.delta;i=i+1){connector.timecodes[i]={percentage:i*1/connector.delta,value:i/connector.delta*connector.durationOfVideo,passed:!1}}}
if(connector.durationOfVideo!=null){connector.timecodes.forEach(function(element){if(event.position>element.value&&(event.position-element.value)<connector.durationOfVideo/connector.delta&&element.passed==!1){var percentage=connector.round(element.percentage*100,1);if(this.verbose){console.log('Video watched for '+percentage+'%')}
connector.createAnalyticView(percentage);element.passed=!0}})}})}
StoryteqConnectorJwPlayer.prototype.analyticPostRequest=function(type,meta){var xhr=new XMLHttpRequest();var url='https://api.storyteq.com/api/v3/open/video/'+this.videoHash;xhr.open('POST',url);xhr.setRequestHeader('Content-Type','application/json');xhr.send(JSON.stringify({'type':type,'meta':meta}))}
StoryteqConnectorJwPlayer.prototype.getVideoData=function(){if(!this.videoHash||this.videoHash===undefined||this.videoHash===null){if(this.defaultUrls){this.setVideoUrl(this.defaultUrls.video_url);this.setPosterUrl(this.defaultUrls.poster_url);this.setJwPlayerInstance({data:{}})}else{document.getElementById(this.videoPlayerId).innerHTML='No video hash has been given';document.getElementById(this.videoPlayerId).style='text-align: center;background:#000;color:#fff;font-weight:900;height:200px;line-height:200px;'
return}}
var xhr=new XMLHttpRequest();xhr.open('GET','https://api.storyteq.com/api/v3/open/video/'+this.videoHash);xhr.onload=(data)=>{var response=JSON.parse(xhr.response);this.setVideoUrl(response.data.video_url);this.setPosterUrl(response.data.poster_url);this.setParameterData(response.data.parameters);this.setJwPlayerInstance(response);if(this.track){this.createAnalyticDevice()}
if(this.dataCallbackFunction){eval('window.'+this.dataCallbackFunction+'()')}}
xhr.send()}
StoryteqConnectorJwPlayer.prototype.createAnalyticDevice=function(){var meta={'browser':{},'os':{}};var browsers=this.environment.Browser;Object.keys(browsers).forEach(function(browser){if(browsers[browser]==!0){meta.browser.name=browser;meta.browser.version=browsers.version.version}});var operatingSystems=this.environment.OS;Object.keys(operatingSystems).forEach(function(os){if(operatingSystems[os]==!0){if(os!='mobile'){meta.os.name=os;meta.os.version=operatingSystems.version.version}}});if(this.environment.OS.mobile==!1){meta.platform='desktop'}else if(this.environment.OS.mobile==!0){meta.platform='mobile'}
if(this.verbose){console.log(meta)}
this.analyticPostRequest('device',meta)}
StoryteqConnectorJwPlayer.prototype.createAnalyticView=function(percentage){var meta={'percentage':percentage};if(this.verbose){console.log('tracking');console.log(meta)}
this.analyticPostRequest('view',meta)}
StoryteqConnectorJwPlayer.prototype.createAnalyticEmbed=function(){this.analyticPostRequest('embed',null)}
StoryteqConnectorJwPlayer.prototype.getParameterValueByName=function(parameterName){for(var i=0;i<this.parameterData.length;i++){if(this.parameterData[i].name==parameterName){return this.parameterData[i].value}}}
StoryteqConnectorJwPlayer.prototype.getUrlParameter=function(name){name=name.replace(/[\[]/,'\\[').replace(/[\]]/,'\\]');var regex=new RegExp('[\\?&]'+name+'=([^&#]*)');var results=regex.exec(location.search);return results===null?'':decodeURIComponent(results[1].replace(/\+/g,' '))};StoryteqConnectorJwPlayer.prototype.setVideoUrl=function(videoUrl){this.videoUrl=videoUrl}
StoryteqConnectorJwPlayer.prototype.setPosterUrl=function(posterUrl){this.posterUrl=posterUrl}
StoryteqConnectorJwPlayer.prototype.setParameterData=function(parameterData){this.parameterData=parameterData}
StoryteqConnectorJwPlayer.prototype.setEnvironment=function(environmentData){this.environment=environmentData}
if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=StoryteqConnectorJwPlayer}else if(typeof require!='undefined'){define(StoryteqConnectorJwPlayer)}