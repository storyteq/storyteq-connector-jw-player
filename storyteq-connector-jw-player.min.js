function StoryteqConnectorJwPlayer(e){var t,o=this;if(!e.videoPlayerId)throw new Error("Missing videoPlayerID.");if(o.videoPlayerId=e.videoPlayerId,o.tracking=!0,e.mediaData)o.mediaData=e.mediaData;else if(e.videoHash)o.videoHash=e.videoHash;else{if(!e.videoParameterName)throw new Error("Missing videoParameterName or videoHash or mediaData.");o.videoHash=o.getUrlParameter(e.videoParameterName)}e.mediaid?o.mediaid=e.mediaid:o.mediaid="WYwyv8s9",e.verbose&&(o.verbose=e.verbose),0==e.tracking&&(o.tracking=e.tracking),e.dataCallbackFunction&&(o.dataCallbackFunction=e.dataCallbackFunction),e.defaultUrls&&(o.defaultUrls=e.defaultUrls),o.jwplayerId="oNX7JPx1",e.jwplayerId&&(o.jwplayerId=e.jwplayerId),e.subs&&(o.subs=e.subs),e.playerSetup&&(o.playerSetup=e.playerSetup),e.events&&(o.events=e.events),o.delta=20,o.durationOfVideo=null,o.timecodes=[],o.videoStarted=!1,o.firstPlay=!0,(t=document.createElement("script")).type="text/javascript",t.readyState?"loaded"===t.readyState&&o.getVideoData():t.onload=function(){o.getVideoData()},t.src="https://content.jwplatform.com/libraries/"+o.jwplayerId+".js",document.getElementsByTagName("head")[0].appendChild(t)}StoryteqConnectorJwPlayer.prototype.setJwPlayerInstance=function(e){var t=this,o=jwplayer(t.videoPlayerId),n={file:t.videoUrl,image:t.posterUrl,mediaid:t.mediaid,events:{onReady:function(){t.createAnalyticEmbed(),t.events&&t.events.onReady&&t.events.onReady()},onComplete:function(){t.videoStarted=!1,t.verbose&&console.log("Video watched for 100% (complete)"),t.createAnalyticView(100),t.events&&t.events.onComplete&&t.events.onComplete()},onPlay:function(){0==t.videoStarted&&(t.videoStarted=!0,t.verbose&&console.log("Video watched for 0% (playstart)"),t.firstPlay&&(t.createAnalyticView(0),t.firstPlay=!1)),t.events&&t.events.onPlay&&t.events.onPlay()},onPause:function(){t.events&&t.events.onPause&&t.events.onPause()}}};if(t.playerSetup)for(var r in t.playerSetup)n[r]=t.playerSetup[r];t.subs&&(n.captions={backgroundOpacity:0,edgeStyle:"uniform"},n.tracks=[{file:t.subs.path,label:t.subs.language,kind:"captions",default:!0}]),o.setup(n),this.createPlayerButton(e,o),this.setEnvironment(o.getEnvironment()),this.videoEventEmitter(o)},StoryteqConnectorJwPlayer.prototype.createPlayerButton=function(e,t){1==e.data.player_logo&&t.addButton("https://storage.googleapis.com/storyteq-shared-assets/video-player/logo.png","Powered by StoryTEQ",function(){window.open("https://storyteq.com/?utm_source=stplayer","_blank")},"about")},StoryteqConnectorJwPlayer.prototype.round=function(e,t){var o=Math.pow(100,t||0);return Math.round(e*o)/o},StoryteqConnectorJwPlayer.prototype.videoEventEmitter=function(t){var n=this;t.onTime(function(o){if(1<o.position&&null==n.durationOfVideo){n.durationOfVideo=t.getDuration();for(var e=1;e<n.delta;e+=1)n.timecodes[e]={percentage:1*e/n.delta,value:e/n.delta*n.durationOfVideo,passed:!1}}null!=n.durationOfVideo&&n.timecodes.forEach(function(e){if(o.position>e.value&&o.position-e.value<n.durationOfVideo/n.delta&&0==e.passed){var t=n.round(100*e.percentage,1);n.verbose&&console.log("Video watched for "+t+"%"),n.createAnalyticView(t),e.passed=!0}})})},StoryteqConnectorJwPlayer.prototype.analyticPostRequest=function(e,t){if((null!=this.mediaData||null!=this.videoHash&&""!=this.videoHash)&&0!=this.tracking){var o=this.videoHash;null!=this.mediaData&&(o=mediaData.hash);var n=new XMLHttpRequest,r="https://api.storyteq.com/v4/open/media/"+o;n.open("POST",r),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("X-Content-Type-Options","nosniff"),n.send(JSON.stringify({type:e,meta:t}))}else connector.verbose&&console.log("No analytics will be created since no unique hash has been provided or tracking has been disabled.")},StoryteqConnectorJwPlayer.prototype.getVideoData=function(){var connector=this;if(connector.videoHash&&null!==connector.videoHash){var xhr=new XMLHttpRequest;xhr.open("GET","https://api.storyteq.com/v4/open/media/"+connector.videoHash),xhr.setRequestHeader("Accept","application/json"),xhr.setRequestHeader("Content-Type","application/json"),xhr.setRequestHeader("X-Content-Type-Options","nosniff"),xhr.onload=function(data){var response=JSON.parse(xhr.response);connector.setVideoUrl(response.data.urls.video),connector.setPosterUrl(response.data.urls),connector.setParameterData(response.data.parameters),connector.setJwPlayerInstance(response),connector.createAnalyticDevice(),connector.dataCallbackFunction&&eval("window."+connector.dataCallbackFunction+"()")},xhr.send()}else connector.mediaData?(connector.mediaData.urls?(connector.setVideoUrl(connector.mediaData.urls.video),connector.mediaData.urls.gif?connector.setPosterUrl(connector.mediaData.urls.gif):connector.mediaData.urls.image&&connector.setPosterUrl(connector.mediaData.urls.image)):(connector.setVideoUrl(connector.mediaData.video_url),connector.setPosterUrl(connector.mediaData.poster_url)),connector.setJwPlayerInstance({data:connector.mediaData}),connector.createAnalyticDevice()):connector.defaultUrls?(connector.setVideoUrl(connector.defaultUrls.video_url),connector.setPosterUrl(connector.defaultUrls.poster_url),connector.setJwPlayerInstance({data:{}})):(document.getElementById(connector.videoPlayerId).innerHTML="No video hash has been given",document.getElementById(connector.videoPlayerId).style="text-align: center;background:#000;color:#fff;font-weight:900;height:200px;line-height:200px;")},StoryteqConnectorJwPlayer.prototype.createAnalyticDevice=function(){var t={browser:{},os:{}},o=this.environment.Browser;Object.keys(o).forEach(function(e){1==o[e]&&(t.browser.name=e,t.browser.version=o.version.version)});var n=this.environment.OS;Object.keys(n).forEach(function(e){1==n[e]&&"mobile"!=e&&(t.os.name=e,t.os.version=n.version.version)}),0==this.environment.OS.mobile?t.platform="desktop":1==this.environment.OS.mobile&&(t.platform="mobile"),this.verbose&&console.log(t),this.analyticPostRequest("device",t)},StoryteqConnectorJwPlayer.prototype.createAnalyticView=function(e){var t={percentage:e};this.verbose&&console.log(t),this.analyticPostRequest("view",t)},StoryteqConnectorJwPlayer.prototype.createAnalyticEmbed=function(){this.analyticPostRequest("embed",null)},StoryteqConnectorJwPlayer.prototype.getParameterValueByName=function(e){for(var t=0;t<this.parameterData.length;t++)if(this.parameterData[t].name==e)return this.parameterData[t].value},StoryteqConnectorJwPlayer.prototype.getUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},StoryteqConnectorJwPlayer.prototype.setVideoUrl=function(e){this.videoUrl=e},StoryteqConnectorJwPlayer.prototype.setPosterUrl=function(e){e.hasOwnProperty("gif")?this.posterUrl=e.gif:e.hasOwnProperty("image")&&(this.posterUrl=e.image)},StoryteqConnectorJwPlayer.prototype.getVideoUrl=function(){return this.videoUrl},StoryteqConnectorJwPlayer.prototype.getPosterUrl=function(){return this.posterUrl},StoryteqConnectorJwPlayer.prototype.setParameterData=function(e){this.parameterData=e},StoryteqConnectorJwPlayer.prototype.setEnvironment=function(e){this.environment=e},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=StoryteqConnectorJwPlayer:"undefined"!=typeof require?define(StoryteqConnectorJwPlayer):window.StoryteqConnectorJwPlayer=StoryteqConnectorJwPlayer;